<!-- Pantalla de carga -->
<div id="loader" class="fixed inset-0 z-50 flex items-center justify-center bg-white">
  <div class="flex flex-col items-center gap-4">
    <div class="h-12 w-12 animate-spin rounded-full border-4 border-gray-300 border-t-red-600"></div>
    <p class="text-sm font-semibold text-gray-700">
      Cargando tickets...
    </p>
  </div>
</div>

<!-- Contenido -->
<div id="contenido" class="hidden">
  <div class="px-5">
    <div class="p-6 space-y-4 border-4 border-black/20  rounded bg-white">

      <h1 class="font-bold text-center text-xl">Tickets</h1>

      <form method="GET" action="/tickets">
        <div class="grid grid-cols-2 gap-4 border-t-4 border-black/30 pt-4">

          <div class="flex flex-col">
            <label class="text-sm font-semibold mb-1">Fecha Inicial</label>
            <input value="<%= typeof fechaInicio !== 'undefined' ? fechaInicio : '' %>" name="fechaInicio" type="date" class="border-2 border-black/50 rounded px-3 py-2" />
          </div>

          <div class="flex flex-col">
            <label class="text-sm font-semibold mb-1">Fecha Final</label>
            <input value="<%= typeof fechaFin !== 'undefined' ? fechaFin : '' %>" name="fechaFin" type="date" class="border-2 border-black/50 rounded px-3 py-2" />
          </div>

        </div>

        <div class="flex justify-end space-x-10 mt-4">

          <button type="submit" class="px-4 py-2 bg-[#FF2A00] text-white rounded">
            Filtrar Tickets
          </button>

          <a href="/tickets" class="px-4 py-2 bg-[#FF2A00] text-white rounded text-center">
            Mostrar todos
          </a>

        </div>
      </form>

      <% if (tickets && tickets.length> 0) { %>
        <div class="overflow-x-auto pt-4">
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gray-600 text-white">
                <th class="px-4 py-2 text-left">Fecha</th>
                <th class="px-4 py-2 text-left">Folio</th>
                <th class="px-4 py-2 text-left">Cliente</th>
                <th class="px-4 py-2 text-left">Pago</th>
                <th class="px-4 py-2 text-center">Productos</th>
                <th class="px-4 py-2 text-left">Total</th>
                <th class="px-4 py-2 text-left">Acciones</th>
              </tr>
            </thead>

            <tbody>
              <% tickets.forEach((ticket)=> { %>
                <tr class="hover:bg-gray-100">
                  <td class="px-4 py-2">
                    <%= ticket.created_at_ticket_formatted %>
                  </td>
                  <td class="px-4 py-2 break-all">
                    <%= ticket.folio %>
                  </td>
                  <td class="px-4 py-2">
                    <%= ticket.nombre_cliente %>
                  </td>
                  <td class="px-4 py-2">
                    <%= ticket.metodo_pago %>
                  </td>

                  <td class="px-4 py-2 text-center">
                    <%= ticket.total_productos %>
                  </td>

                  <td class="px-4 py-2 font-semibold">
                    <%= ticket.total_pago %>
                  </td>
 
                  <td class="px-4 py-2 space-x-2">
                    <a href="/tickets/preview/<%= ticket.folio %>" class="bg-green-500 text-white px-2.5 py-2.5 rounded inline-block">
                      <i class="fa-solid fa-eye"></i>
                    </a>

                    <a role="button" class="btnEditar bg-yellow-300 px-2.5 py-2.5 rounded inline-block"
                      data-ticket='<%- JSON.stringify(ticket) %>'>
                      <i class="fa-solid fa-pen"></i>
                    </a>

                    <!-- <%= ticket.folio %> -->
                    <a href="/tickets/delete/" class="bg-red-500 text-white px-2.5 py-2.5 rounded inline-block">
                      <i class="fa-solid fa-trash"></i>
                    </a>
                  </td>
                </tr>
                <% }) %>
            </tbody>
          </table>
        </div>

        <% } else { %>
          <div class="border-black/30 border-t-4 p-6">
            <p class="text-center font-bold text-2xl">Tickets no encontrados</p>
          </div>
          <% } %>
    </div>
  </div>
</div>

<!-- Fondo Editar -->
<div id="modalBackdrop" class="fixed inset-0 bg-black/50 z-40 hidden"></div>

<!-- Modal Editar -->
<div id="modalTicket" class="fixed inset-0 z-50 hidden items-center justify-center">
  <div class="bg-white w-full max-w-lg rounded shadow-lg p-6">
    <h2 class="text-xl font-bold mb-4">Editar Ticket</h2>

    <form method="POST">
      <div class="space-y-4">

        <div>
          <label class="block text-sm font-semibold mb-1">Fecha</label>
          <input id="fecha" type="text" name="fecha"
            class="w-full border rounded px-3 py-2 bg-gray-100 cursor-not-allowed" readonly>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">Folio</label>
          <input id="folio" type="text" name="folio"
            class="w-full border rounded px-3 py-2 bg-gray-100 cursor-not-allowed" readonly>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">Nombre del cliente</label>
          <input id="cliente" type="text" name="cliente"
            class="w-full border rounded px-3 py-2 bg-gray-100 cursor-not-allowed" readonly>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">MÃ©todo de Pago</label>
          <select id="metodo_pago" name="metodo_pago"
            class="w-full border rounded px-3 py-2 bg-gray-100 cursor-not-allowed" disabled>
            <option value="efectivo">Efectivo</option>
            <option value="Tarjeta">Tarjeta</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">Cantidad de productos</label>
          <input id="cant_prod" type="number" name="cant_prod"
            class="w-full border rounded px-3 py-2 bg-gray-100 cursor-not-allowed" readonly>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">Total</label>
          <input id="total" type="number" step="0.01" name="total"
            class="w-full border rounded px-3 py-2 bg-gray-100 cursor-not-allowed" readonly>
        </div>

      </div>

      <div class="flex justify-end gap-3 mt-6">
        <button type="button" id="btnCerrarModal" class="px-4 py-2 bg-gray-400 text-white rounded">
          Cancelar
        </button>

        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<%- include('../partials/alertModal') %>

  <!-- Renderizar error -->
  <% if (errorMessage) { %>
    <script>
      window.SERVER_ERROR = "<%= errorMessage %>";
    </script>
    <% } %>

      <script src="/js/tickets.js"></script>