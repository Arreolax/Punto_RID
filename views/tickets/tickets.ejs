<!-- Pantalla de carga -->
<%- include('../partials/loadingScreen', { loaderText: 'Cargando Tickets...' }) %>

  <!-- Contenido -->
  <div id="contenido" class="hidden">
    <div class="px-5">
      <div class="p-6 space-y-4 border-4 border-black/20  rounded bg-white">

        <h1 class="font-bold text-center text-xl">Tickets</h1>

        <!-- Formulario de busqueda -->
        <form method="GET" action="/tickets">
          <div class="grid grid-cols-2 gap-4 border-t-4 border-black/30 pt-4">

            <div class="flex flex-col">
              <label class="text-sm font-semibold mb-1">Fecha Inicial</label>
              <input title="Fecha Inicial" value="<%= typeof fechaInicio !== 'undefined' ? fechaInicio : '' %>"
                name="fechaInicio" type="date" class="border-2 border-black/50 rounded px-3 py-2" />
            </div>

            <div class="flex flex-col">
              <label class="text-sm font-semibold mb-1">Fecha Final</label>
              <input title="Fecha Final" value="<%= typeof fechaFin !== 'undefined' ? fechaFin : '' %>" name="fechaFin"
                type="date" class="border-2 border-black/50 rounded px-3 py-2" />
            </div>
          </div>

          <div class="flex justify-end space-x-10 mt-4">

            <button title="Buscar por fechas" type="submit" class="px-4 py-2 bg-[#FF2A00] text-white rounded">
              Filtrar Tickets
            </button>

            <a title="Ver todos los tickets registrados" href="/tickets"
              class="px-4 py-2 bg-[#FF2A00] text-white rounded text-center">
              Mostrar todos
            </a>

          </div>
        </form>
        <% if (tickets && tickets.length> 0) { %>
          <div class="overflow-x-auto pt-4">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-gray-600 text-white">
                  <th class="px-4 py-2 text-left">Fecha de Creacion</th>
                  <th class="px-4 py-2 text-left">Folio</th>
                  <th class="px-4 py-2 text-left">Nombre de Cliente</th>
                  <th class="px-4 py-2 text-left">Metodo de Pago</th>
                  <th class="px-4 py-2 text-center">Productos</th>
                  <th class="px-4 py-2 text-left">Total</th>
                  <th class="px-4 py-2 text-left">Acciones</th>
                </tr>
              </thead>

              <tbody>
                <% tickets.forEach((ticket)=> { %>
                  <tr class="hover:bg-gray-100">
                    <td class="px-4 py-2">
                      <%= ticket.created_at_ticket_formatted %>
                    </td>
                    <td class="px-4 py-2 break-all">
                      <%= ticket.folio %>
                    </td>
                    <td class="px-4 py-2">
                      <%= ticket.nombre_cliente %>
                    </td>
                    <td class="px-4 py-2">
                      <%= ticket.metodo_pago.charAt(0).toUpperCase() + ticket.metodo_pago.slice(1).toLowerCase() %>
                    </td>

                    <td class="px-4 py-2 text-center">
                      <%= ticket.total_productos %> productos
                    </td>

                    <td class="px-4 py-2 font-semibold">
                      $<%= ticket.total_pago %>
                    </td>

                    <td class="px-4 py-2 space-x-2">
                      <a title="Ver Ticket" href="/tickets/preview/<%= ticket.folio %>"
                        class="bg-green-500 text-white px-2.5 py-2.5 rounded inline-block">
                        <i class="fa-solid fa-eye"></i>
                      </a>

                      <!-- <%= ticket.folio %> -->
                      <a title="Eliminar Ticket" href="/tickets/delete/"
                        class="bg-red-500 text-white px-2.5 py-2.5 rounded inline-block">
                        <i class="fa-solid fa-trash"></i>
                      </a>
                    </td>
                  </tr>
                  <% }) %>
              </tbody>
            </table>
          </div>

          <% } else { %>
            <div class="border-black/30 border-t-4 p-6 text-center">
              <p class="text-center font-bold text-2xl">Tickets no encontrados</p>
              <i class="fa-solid fa-circle-exclamation text-[120px] pt-3 text-red-500"></i>
            </div>
            <% } %>
      </div>
    </div>
  </div>

  <!-- Alert Modal -->
  <%- include('../partials/alertModal') %>

    <!-- Renderizar error -->
    <script>
      window.errorMessage = "<%= errorMessage || '' %>";
    </script>

    <script src="/js/tickets.js"></script>