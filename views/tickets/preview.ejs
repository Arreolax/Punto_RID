<!-- Pantalla de carga -->
<%- include('../partials/loadingScreen', { loaderText: 'Cargando Ticket...' }) %>

  <!-- Contenido -->
  <% if (ticket) { %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 px-5 items-start">

      <!-- Ticket Info -->
      <div class="pt-4 p-6 space-y-3 border border-black/50 rounded">
        <h1 class="font-bold text-center">Informacion del ticket</h1>

        <div class="border-t-2 border-black/50  pt-2 flex gap-3">
          <span class="font-semibold">Fecha y hora de creacion:</span>
          <span class="italic">
            <%= ticket.fecha %>
          </span>
        </div>

        <div class="border-t-2 border-black/50  pt-2 flex gap-3">
          <span class="font-semibold">Nombre del vendedor:</span>
          <span class="italic">
            <%= ticket.nombre_empleado %>
          </span>
        </div>

        <div class="border-t-2 border-black/50 pt-2 flex gap-3">
          <span class="font-semibold">Folio del ticket:</span>
          <span class="italic">
            <%= ticket.folio %>
          </span>
        </div>

        <div class="border-t-2 border-black/50 pt-2 flex gap-3">
          <span class="font-semibold">Nombre del cliente:</span>
          <span class="italic">
            <%= ticket.nombre_cliente %>
          </span>
        </div>

        <div class="border-t-2 border-black/50 pt-2 flex gap-3">
          <span class="font-semibold">Método de pago:</span>
          <span class="italic">
            <%= ticket.metodo_pago.charAt(0).toUpperCase() + ticket.metodo_pago.slice(1).toLowerCase() %>
              <!-- Solo la incial con Mayuscula -->
          </span>
        </div>

        <% if (ticket.metodo_pago=="efectivo" ) { %>
          <div class="border-t-2 border-black/50 pt-2 flex gap-3">
            <span class="font-semibold">Efectivo recibido:</span>
            <span class="italic font-bold">$<%= ticket.total_recibido %></span>
          </div>
          <% } %>

            <div class="border-t-2 border-black/50 pt-2 flex gap-3">
              <span class="font-semibold">Total de compra:</span>
              <span class="italic font-bold">$<%= ticket.total_pago %></span>
            </div>

            <% if (ticket.metodo_pago=="efectivo" ) { %>
              <div class="border-t-2 border-black/50 pt-2 flex gap-3">
                <span class="font-semibold">Cambio devuelto:</span>
                <span class="italic font-bold text-green-700">$<%= ticket.cambio %></span>
              </div>
              <% } %>

                <!-- Tabla -->
                <div class="pt-4 overflow-x-auto">
                  <table class="w-full table-auto border-collapse">
                    <thead>
                      <tr class="bg-gray-600 text-white">
                        <th class="px-4 py-2">Nombre</th>
                        <th class="px-4 py-2">Descripción</th>
                        <th class="px-4 py-2">Precio Unitario</th>
                        <th class="px-4 py-2">Cantidad</th>
                        <th class="px-4 py-2">Subtotal</th>
                      </tr>
                    </thead>
                    <tbody class="text-center">
                      <% ticket.productos.forEach(producto=> { %>
                        <tr class="hover:bg-gray-100">
                          <td class="px-4 py-2">
                            <%= producto.nombre %>
                          </td>
                          <td class="px-4 py-2 italic">
                            <%= producto.descripcion==null ? "Sin Descripcion" : producto.descripcion %>
                          </td>
                          <td class="px-4 py-2">
                            $<%= producto.precio_unidad %>
                          </td>
                          <td class="px-4 py-2">
                            <%= producto.cantidad %> pz.
                          </td>
                          <td class="px-4 py-2 font-bold">
                            $<%= producto.subtotal %>
                          </td>
                        </tr>
                        <% }) %>
                    </tbody>
                  </table>

                  <div class="flex justify-center border-t-2 border-black/50 mt-4">
                    <button id="btnRegresar"
                      class="mt-4 px-4 py-2 bg-[#FF2A00] text-white rounded hover:bg-[#FF2A00]/80">
                      Regresar
                    </button>
                  </div>
                </div>

      </div>

      <!-- Preview -->
      <div class="pt-4 p-6 space-y-3 border border-black/50 rounded text-center">
        <h1 class="font-bold">Vista Previa</h1>

        <div class="flex justify-center">
          <%- include('../components/ticket', { ticket }) %>
        </div>

        <div class="flex justify-center gap-4">
          <button id="btnGenerarPDF" data-folio="<%= ticket.folio %>"
            class="mt-4 px-4 py-2 bg-[#FF2A00] text-white rounded hover:bg-[#FF2A00]/80">
            Descargar Ticket
          </button>

          <button class="mt-4 px-4 py-2 bg-[#FF2A00] text-white rounded hover:bg-[#FF2A00]/80">
            Imprimir Ticket
          </button>

          <button class="mt-4 px-4 py-2 bg-[#FF2A00] text-white rounded hover:bg-[#FF2A00]/80">
            Generar Factura
          </button>
        </div>
      </div>

    </div>
    <% }else{ %>
      <div class="border-black/30 border-t-4 p-6 text-center">
        <p class="text-center font-bold text-2xl">Ticket no encontrado</p>
        <i class="fa-solid fa-circle-exclamation text-[120px] pt-3 text-red-500"></i>
      </div>
      <% } %>

        <!-- Alert Modal -->
        <%- include('../partials/alertModal') %>

          <script>
            window.errorMessage = "<%= errorMessage || '' %>";
          </script>


          <script src="/js/ticket-preview.js"></script>